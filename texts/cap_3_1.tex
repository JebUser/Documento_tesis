\section{Definir}
\subsection{Requerimientos}
A partir del análisis de usuarios, contexto y objetivos pedagógicos, se consolidó un conjunto de requisitos funcionales y no funcionales que garantizan accesibilidad, rendimiento y trazabilidad de la experiencia, sirviendo como base para diseño, implementación y validación con profesionales del INCS.% [Fuente: l.

\subsection{Requisitos Funcionales (RF)} \label{RF}
% Nota: Se preserva el contenido del listado y se ajusta la numeración para evitar duplicados de etiquetas.
\begin{itemize}
  \item RF-01: El sistema mostrará un menú de inicio en VR con opciones de Iniciar Juego y Opciones.
  \item RF-02: El sistema debe permitirle al jugador elegir entre dos niveles de dificultad: novato y experto.
  \item RF-03: El sistema debe mostrar la historia mediante audio y subtítulos legibles, grandes y sencillos.
  \item RF-04: El sistema debe mostrar preguntas contextuales sencillas en cuadros de texto grandes con imágenes simples antes de los minijuegos.
  \item RF-05: El sistema debe mostrar una guía audiovisual de cómo se debe desarrollar cada minijuego.
\end{itemize}

\subsection{Requisitos No Funcionales (RNF)}
\begin{itemize}
  \item RNF-01: Las texturas y colores deben ofrecer contrastes aptos para usuarios con dificultades visuales.
  \item RNF-02: El sistema debe ejecutarse a \(\geq 30\) FPS en el dispositivo objetivo.
  \item RNF-03 Deben usarse indicadores y guías claras y visibles en objetivos y zonas.
  \item RNF-04: Debe haber colisiones invisibles que impidan avanzar a zonas no permitidas.
  \item RNF-05: Compatibilidad con gafas Meta Quest 3.
  \item RNF-06: Arquitectura modular para facilitar mantenimiento y evolución.
\end{itemize}

\subsection{Selección del entorno de desarrollo}

La elección del entorno de desarrollo es crucial para garantizar la viabilidad técnica y la accesibilidad del prototipo. 
Se evaluaron diversas opciones considerando su madurez, facilidad de uso, mantenimiento, portabilidad y capacidad para 
integrar las características necesarias para el proyecto.

\subsubsection{Criterios de selección}

Se priorizaron los siguientes criterios en la selección de tecnologías:

\begin{itemize}
\item \textbf{Fiabilidad:} se priorizó una pila madura, con soporte activo, documentación amplia y casos de uso consolidados en XR educativa y prototipado rápido, reduciendo riesgos técnicos en un entorno con sesiones cortas y supervisadas en el INCS.

\item \textbf{Facilidad de manipulación:} se favorecieron herramientas con flujos de trabajo visuales, depuración sencilla en dispositivo y perfiles de entrada accesibles (voz, subtítulos, vibración, alto contraste) para iterar con terapeutas y población infantil.

\item \textbf{Mantenimiento:} se buscó modularidad por escenas/paquetes, configuración por ScriptableObjects, y separación de lógica, datos y presentación para facilitar cambios en narrativa, actividades y accesibilidad sin refactorizaciones costosas.

\item \textbf{Portabilidad:} se eligieron APIs estándar XR y paquetes oficiales para minimizar acoplamientos específicos, apuntando a portabilidad intra-ecosistema Meta (Quest 2/3/Pro) y reduciendo retrabajo en perfiles de rendimiento.
\end{itemize}

\subsubsection{Motor de desarrollo: Unity}

Unity ofrece un ecosistema consolidado para XR con pipeline de render flexible, perfiles de calidad por dispositivo y perfiles de entrada configurables, lo que acelera prototipado y pruebas con usuarios en contextos educativos.

Se recomienda emplear los siguientes paquetes y librerías:

\begin{itemize}
\item \textbf{XR Plugin Management y OpenXR de Unity:} proporcionan estandarización en interacción y evitan SDKs propietarios que limiten la portabilidad.

\item \textbf{XR Interaction Toolkit:} facilita interacciones de mano/controlador, locomoción por teletransporte y otras mecánicas de entrada accesibles.

\item \textbf{TextMesh Pro:} para tipografía de alto contraste y gran tamaño.

\item \textbf{Paquetes de Accessibility/Localization:} para subtítulos y guía en voz.

\item \textbf{Input System:} para mapear esquemas accesibles y alternativos, manteniendo la base en APIs soportadas por el runtime XR.
\end{itemize}

La división por escenas (portada, tutorial, minijuegos, cierre), prefabs reutilizables y configuración de actividades por datos permite que terapeutas sugieran ajustes sobre parámetros sin modificar código central, facilitando iteraciones de diseño inclusivo.

\subsubsection{Hardware base: Meta Quest 3}

\paragraph{Accesibilidad al desarrollo:}
La línea Quest permite despliegue autónomo (standalone) con instalación directa del paquete y herramientas de depuración sobre Wi-Fi/USB, lo que simplifica ciclos de prueba en el INCS sin infraestructura adicional de PC VR.

\paragraph{Capacidades de hardware:}
Al combinar capacidad de cómputo móvil, seguimiento integrado y controladores hápticos, Quest 3 soporta experiencias inmersivas con audio espacial y retroalimentación vibratoria, adecuadas para actividades guiadas y narrativa con accesibilidad perceptual.

\paragraph{Comodidad y sesiones:}
El formato standalone reduce cableado y distracciones, facilitando sesiones cortas con pausas programadas, integrando técnicas de locomoción segura (teletransporte) y viñeteado para mitigación de mareo.

\subsubsection{Facilidad de manipulación}

\paragraph{Software:}
El ciclo editar-probar-medir es ágil con perfiles de calidad, capturas de rendimiento y logs de eventos (intentos, tiempos, aciertos/errores), lo que facilita observar impacto de cambios en accesibilidad y narrativa por iteración.

\paragraph{Hardware:}
La instalación directa en Quest 2/3 habilita pruebas de campo y observación no intrusiva, incluso sin proyección espejo, siguiendo el avance por señales auditivas cuando sea necesario, en línea con el protocolo aplicado en las visitas al INCS.

\subsubsection{Mantenibilidad}

\paragraph{Arquitectura modular:}
La separación de lógica de juego, controladores de accesibilidad (contraste, subtítulos, audio descriptivo), y datos de actividades permite integrar nuevas escenas/retos sin afectar el núcleo, conservando la trazabilidad con requisitos y criterios de aceptación.

\paragraph{Instrumentación ligera:}
Los registros de eventos y métricas de rendimiento se mantienen desacoplados de la lógica de escena, facilitando análisis posterior y resguardo de privacidad/consentimiento según lineamientos éticos reportados.

\subsubsection{Portabilidad dentro de Meta Quest}

Aunque el desarrollo se centra en Meta Quest 3, el objetivo es que la aplicación sea portable al menos al resto de la serie Meta Quest (p. ej., Quest 2), ajustando perfiles de calidad, texturas y presupuesto de geometría para mantener accesibilidad y rendimiento.

Al basarse en OpenXR, XR Interaction Toolkit y paquetes oficiales, la dependencia de SDKs específicos se reduce, y el esfuerzo de portabilidad se enfoca en tuning de rendimiento, escalado de UI accesible y validación de interacciones en cada dispositivo objetivo.

Este conjunto de decisiones equilibra fiabilidad y velocidad de iteración con requisitos de accesibilidad, mantenimiento y validación en campo, conservando la posibilidad de ampliar la cobertura a más dispositivos dentro del ecosistema Meta sin comprometer la experiencia educativa ni la calidad técnica del prototipo.

\section{Diseño}

El siguiente apartado detalla las decisiones de diseño tomadas para cumplir con los requisitos funcionales y no funcionales establecidos en la fase anterior, enfocándose en aspectos clave como la narrativa, mecánicas de juego, accesibilidad y mitigación de riesgos.

\subsection{Mecánicas de los juegos} \label{sec:mecanicas-juegos}
Teniendo en cuenta el enfoque para las actividades propuesto en \ref{sec:actividades-juego}, se optó por diseñar una serie de minijuegos que fueran fieles a la linealidad de la narrativa y representaran un reto para los niños, de tal forma que se mantuviera su interés y motivación a lo largo de la experiencia
y a su vez se reforzaran los objetivos pedagógicos planteados. Cada minijuego se diseñó para ser intuitivo y accesible, con controles simples y una guía tanto visual como auditiva para facilitar la comprensión y participación de los niños. Los minijuegos realizados fueron los siguientes:
\begin{enumerate}
  \item \textbf{Comida Favorita del Oso:} Consiste en una pregunta de selección múltiple en la que se le presenta al niño tres opciones de comidas favoritas distintas, pero solo una es la correcta. El oso menciona su comida favorita desde el inicio de la historia, por lo que el niño debe recordar esta información para responder correctamente.
  \item \textbf{Conseguir las Bromelias:} Ahora el niño deberá de escalar un árbol que contiene bromelias para poder alimentar al oso de anteojos. El niño debe usar las manos para agarrar las bromelias y poder comérselas.
  \item \textbf{Líquido para Beber:} Consiste en una pregunta de selección múltiple en la que se le presenta al niño tres opciones de líquidos para saciar la sed del oso. El niño deberá reconocer intuitivamente el líquido perfecto para poder ayudar al oso (en este caso, el agua).
  \item \textbf{Beber el Agua:} El niño deberá de ayudar al oso a beber agua de un lago. Para esto, el niño debe usar sus manos para llenar un vaco con agua y luego llevarlo a la boca del oso para que pueda beber.
  \item \textbf{Reconocer los Sentimientos del Oso:} Consiste en una pregunta de selección múltiple en la que se le presenta al niño tres opciones de sentimientos distintos. El niño deberá reconocer el sentimiento del oso basándose en las pistas contextuales proporcionadas durante la narrativa.
  \item \textbf{Atrapar al pez:} El niño deberá ayudar al oso a atrapar un pez en un lago, el cual se llevó las gafas del oso. Para esto, el niño debe usar sus manos para tratar de atrapar al pez mientras este trata de huir de él. Con esto se busca trabajar la motricidad fina, la coordinación ojo-mano y enfatizar los valores de justicia y respeto.
\end{enumerate}

Los detalles sobre la implementación de cada uno de estos minijuegos se encuentran en la sección \ref{} correspondiente a la implementación del prototipo.

\subsection{Narrativa}
La narrativa del prototipo sigue el relato del ''Oso que Perdió sus Anteojos'', una historia diseñada por los profesionales del INCS en colaboración con el proyecto Colombia-Quebec.
La historia trata sobre un oso de anteojos que buscaba un lago para poder tomar agua, pero pierde sus gafas cuando se agacha a beber, a lo que un pez llega y se lleva las gafas del oso.
El oso se pone triste, a lo que el pez se siente culpable y decide devolverle las gafas al oso (Ver Figura \ref{fig:cuento-instituto}).

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{img/cuento-instituto.png}
    \caption{Imagen ilustrativa del cuento ''El Oso que Perdió sus Anteojos'' proporcionada por el INCS.}
    \label{fig:cuento-instituto}
\end{figure}

No obstante, para poder adaptar la narrativa al entorno de realidad virtual y a los objetivos pedagógicos planteados, se vio necesario realizar algunas modificaciones en la historia original. Con ayuda de los profesionales del INCS, la historia fue adaptada para incluir nuevos elementos que permitieran realizar los minijuegos propuestos. Por ejemplo, se añadió la necesidad del oso de alimentarse con bromelias y tener que atrapar al pez, lo que permitió incluir minijuegos relacionados con estas actividades. De esta manera, el relato del ''Oso que Perdió sus Anteojos''
quedó de la siguiente manera:

\begin{play}

\subsection*{Historia del Oso y sus Anteojos}

\dialogue{Narrador}{Esta es la historia del oso que perdió sus anteojos.}

\dialogue{Oso}{¡Hola, amigo! ¿Cómo estás? ¡Espero que muy bien! (rugido de tripas) Tengo muuuucha hambre, ¿me ayudas a encontrar comida? Me gustan mucho las bromelias}

\begin{stage}
El oso extiende su pata, se le avisa al jugador por texto, audio y video que toque la pata del oso.
El jugador toca la pata y se convierte en el oso.
Se teletransporta a la zona 1.
\end{stage}

\subsubsection*{Primera elección: ¿Qué come el oso?}

\dialogue{Narrador}{El señor oso tiene mucha hambre, ¿cuál es la comida favorita del oso?}

\begin{itemize}
  \item Manzana, acompañado de una imagen del objeto y el audio del objeto hablado.
  \item Bromelia, acompañado de una imagen del objeto y el audio del objeto hablado.
  \item Zanahoria, acompañado de una imagen del objeto y el audio del objeto hablado.
\end{itemize}

\begin{stage}
Si se selecciona mal, la opción se oscurece y muestra una ``X'' roja, deshabilitándose acompañado de un sonido de error.
\end{stage}

\textbf{Diálogos aleatorios al fallar:}

\dialogue{Narrador}{Mmm nooo, creo que al oso no le gusta eso.}
\dialogue{Narrador}{¡Estuviste cerca!, pero el oso no quiere eso.}
\dialogue{Narrador}{Noo, no es correcto, ¡inténtalo nuevamente!}

\begin{stage}
Si se selecciona bien, se reproduce un sonido de acierto acompañado de un chulo verde al cuadro de selección.
\end{stage}

\dialogue{Oso}{¡Muy bien! ¡Ese árbol de ahí tiene bromelias! ¿Me ayudarías a conseguir las bromelias?}

\subsubsection*{Minijuego: Escalar}

\begin{stage}
Comienza un minijuego de escalar: Se da un tutorial vía texto, audio y video incluido para el desarrollo del juego.  
Termina el minijuego.
\end{stage}

\dialogue{Oso}{Mmm qué rico, ¡muchas gracias! (jadeante) Ahora tengo sed.}

\subsubsection*{Segunda elección: ¿Qué puede tomar el oso?}

\dialogue{Narrador}{El oso tiene sed, ¿qué puede tomar el oso para calmar su sed?}

\begin{itemize}
  \item Agua, acompañado de una imagen del objeto y el audio del objeto hablado.
  \item Café, acompañado de una imagen del objeto y el audio del objeto hablado.
  \item Jugo, acompañado de una imagen del objeto y el audio del objeto hablado.
\end{itemize}

\begin{stage}
Si se selecciona mal, la opción se oscurece y muestra una ``X'' roja, deshabilitándose acompañado de un sonido de error.
\end{stage}

\textbf{Diálogos aleatorios al fallar:}

\dialogue{Narrador}{Nooo, el oso no puede tomar eso.}
\dialogue{Narrador}{Mmm, creo que no es correcto.}
\dialogue{Narrador}{Noo, no es correcto, ¡inténtalo nuevamente!}

\begin{stage}
Si se selecciona bien, se reproduce un sonido de acierto acompañado de un chulo verde al cuadro de selección, y se teletransporta la zona cerca al lago.
\end{stage}

\dialogue{Narrador}{¡Mira! ¡Un vaso para tomar agua! ¿Ayudas al oso a tomar agua?}

\begin{stage}
Empieza el minijuego de tomar agua, el niño debe introducir el vaso al lago, y luego hacer el gesto de tomar agua (3 veces en fácil y 5 veces en difícil) hasta que se llene una barra.  
Una vez terminado del minijuego, se muestran las gafas del oso en frente del jugador para posteriormente caer al lago.
\end{stage}

\dialogue{Oso}{¡Oh no! Mis gafas (en tono triste y llorando)}

\subsubsection*{Tercera elección: ¿Cómo se siente el oso?}

\dialogue{Narrador}{¡Oh no! El oso está llorando mucho, ¿cómo crees que se siente el oso?}

\begin{itemize}
  \item Enojado, acompañado de una imagen representando la emoción y el audio de la emoción hablada. 
  \item Alegre, acompañado de una imagen representando la emoción y el audio de la emoción hablada.
  \item Triste, acompañado de una imagen representando la emoción y el audio de la emoción hablada.
\end{itemize}

\begin{stage}
Si se selecciona mal, la opción se en oscurecer descartándose, deshabilitándose acompañado de un sonido de error.
\end{stage}

\textbf{Diálogos aleatorios al fallar:}

\dialogue{Narrador}{¡Nooo! El oso no se siente así.}
\dialogue{Narrador}{¡Casi aciertas! Pero no se siente así.}
\dialogue{Narrador}{Noo, no es correcto, ¡inténtalo nuevamente!}

\begin{stage}
Aparece un pez y agarra las gafas.
\end{stage}

\dialogue{Pez}{Me gustan estas gafas, ¡ahora son mías! (Tono malicioso)}

\dialogue{Oso}{¡Noo, son mías! (molesto)}

\begin{stage}
Comienza el minijuego: el niño deberá atrapar al pez (dependiendo de la dificultad, el pez es más rápido o lento).
El niño logra atrapar al pez.
\end{stage}

\dialogue{Pez}{Vale, perdón perdón, tranquilo, es broma. Suéltame por favor.}

\begin{stage}
El jugador suelta al pez.
\end{stage}

\dialogue{Pez}{Toma}  
\begin{stage}
El pez intenta darle las gafas al oso, pero se le caen al agua hacia el río.
\end{stage}

\dialogue{Pez}{¡Oh no! ¡Lo siento!}

\dialogue{Oso}{Yo quiero mis gafas, ¿me ayudas?}

\dialogue{Pez}{Sí, yo te ayudo, confía en mi}

\begin{stage}
El pez se sumerge para recuperar las gafas.  
El pez emerge a la superficie con las gafas.
\end{stage}

\dialogue{Oso}{¡Mis gafas! ¡Gracias por recuperarlas amigo!}

\begin{stage}
El jugador agarra las gafas y se las pone.  
El jugador vuelve a transformarse en humano.
\end{stage}

\dialogue{Oso}{¡Gracias, compañero!¡Choquen esos 5!}

\begin{stage}
Chocan los 5 y se termina el juego.
\end{stage}

\end{play}


\subsection{Interfaz}

Con el objetivo de cumplir con los requisitos RF-01, RF-02 y RF-04 presentados en \ref{RF}, se propuso desarrollar una interfaz que priorizara el simplismo y la claridad visual, utilizando elementos de alto contraste y tipografía grande para facilitar la lectura y comprensión por parte de los niños.
La interfaz se diseñó para ser intuitiva, con iconografía clara y botones grandes que faciliten la interacción en un entorno de realidad virtual. La idea inicial del diseño de la interfaz se encuentra en las Figuras \ref{fig:mockup-menu}, \ref{fig:mockup-pregunta}, \ref{fig:mockup-difficulty}, \ref{fig:mockup-questions}, \ref{fig:mockup-thirst}, \ref{fig:mockup-hunger} y \ref{fig:mockup-tutorial}.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{img/mockup-menu.png}
    \caption{Imagen ilustrativa del diseño inicial del menú principal del prototipo.}
    \label{fig:mockup-menu}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{img/mockup-options.png}
    \caption{Imagen ilustrativa del diseño inicial de las opciones de configuración del prototipo.}
    \label{fig:mockup-pregunta}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{img/mockup-difficulty.png}
    \caption{Imagen ilustrativa del diseño inicial para el selector de dificultad del prototipo.}
    \label{fig:mockup-difficulty}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{img/mockup-questions.png}
    \caption{Imagen ilustrativa del diseño inicial de las preguntas.}
    \label{fig:mockup-questions}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{img/mockup-thirst.png}
    \caption{Imagen ilustrativa del indicador de saciedad para el minijuego de tomar agua.}
    \label{fig:mockup-thirst}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{img/mockup-hunger.png}
    \caption{Imagen ilustrativa del indicador de saciedad para el minijuego de comer bromelias.}
    \label{fig:mockup-hunger}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{img/mockup-tutorial.png}
    \caption{Imagen ilustrativa de los tutoriales.}
    \label{fig:mockup-tutorial}
\end{figure}

\subsection{Diagrama de Flujo}

El siguiente diagrama de flujo (Figura \ref{fig:flow-diagram}) muestra el órden en el que ocurren los eventos dentro del prototipo y cuándo se presenta cada uno de los minijuegos al usuario.

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{img/flow-diagram.png}
    \caption{Diagrama de Flujo del prototipo.}
    \label{fig:flow-diagram}
\end{figure}

\subsection{Diagrama de casos de uso}

El siguiente diagrama de casos de uso (Figura \ref{fig:use-cases-diagram}) ilustra las interacciones entre el usuario y el sistema, destacando las funcionalidades principales del prototipo.

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{img/use-cases-diagram.png}
    \caption{Diagrama de Casos de Uso del prototipo.}
    \label{fig:use-cases-diagram}
\end{figure}